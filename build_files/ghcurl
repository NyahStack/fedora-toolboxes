#!/usr/bin/env bash
set -euo pipefail

# Upstream source:
#   https://github.com/ublue-os/bazzite/blob/main/build_files/ghcurl
# Local modifications:
#   - Reads GITHUB_TOKEN from environment (exported from build secret by Containerfile/Justfile).
#   - Keeps behavior minimal for this repository's build flow.
#
# Use GITHUB_TOKEN when available (from build secret export in Containerfile)
if [[ -n "${GITHUB_TOKEN:-}" ]]; then
    AUTH_ARGS=(
        "-H" "Accept: application/vnd.github+json"
        "-H" "Authorization: Bearer ${GITHUB_TOKEN}"
        "-H" "X-GitHub-Api-Version: 2022-11-28"
    )
else
    AUTH_ARGS=()
fi

URL="$1"
shift || true

curl --retry 3 --retry-delay 2 --retry-max-time 60 --fail -sSL \
    "${AUTH_ARGS[@]}" \
    "$@" \
    "$URL"
